<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RADAR - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="background-animation"></div>
    
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="{{ url_for('index') }}" class="nav-logo-link">
                    <h1 class="nav-logo">üì° RADAR PRO</h1>
                    <span class="nav-subtitle">Advanced Financial News Monitoring</span>
                </a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div class="header-actions">
                <div class="action-buttons">
                    <button id="refresh-btn" class="btn btn-primary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    <button id="collect-now-btn" class="btn btn-secondary">üöÄ –°–æ–±—Ä–∞—Ç—å —Å–µ–π—á–∞—Å</button>
                    <button id="neural-status-btn" class="btn btn-secondary">üß† –°—Ç–∞—Ç—É—Å AI</button>
                </div>
                <span class="last-updated">–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update-time">--:--</span></span>
                <div class="system-status">
                    <span class="status-indicator" id="system-status">‚ö°</span>
                    <span class="status-text" id="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è sorts -->
            <div class="sorting-controls">
                <div class="sort-group">
                    <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                    <select id="sort-select" class="sort-select">
                        <option value="hotness">–ü–æ –≤–∞–∂–Ω–æ—Å—Ç–∏</option>
                        <option value="date_new">–ü–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ)</option>
                        <option value="date_old">–ü–æ –¥–∞—Ç–µ (—Å—Ç–∞—Ä—ã–µ)</option>
                        <option value="source">–ü–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É</option>
                    </select>
                </div>
                
                <div class="sort-group">
                    <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
                    <select id="priority-select" class="priority-select">
                        <option value="all">–í—Å–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã</option>
                        <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                        <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="low">–ù–∏–∑–∫–∏–π</option>
                    </select>
                </div>
            </div>

            <div id="sorting-info" class="sorting-info"></div>

            <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ –ù–° -->
            <div id="neural-status-panel" class="neural-status-panel hidden">
                <div class="neural-status-card">
                    <h3>üß† –°—Ç–∞—Ç—É—Å –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π</h3>
                    <div id="neural-status-content">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>

            <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="advanced-stats-panel" class="advanced-stats-panel hidden">
                <div class="stats-grid">
                    <div class="stat-card international">
                        <div class="stat-value" id="international-news">0</div>
                        <div class="stat-label">–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ</div>
                    </div>
                    <div class="stat-card russian">
                        <div class="stat-value" id="russian-news">0</div>
                        <div class="stat-label">–†–æ—Å—Å–∏–π—Å–∫–∏–µ</div>
                    </div>
                    <div class="stat-card high-priority">
                        <div class="stat-value" id="high-priority-count">0</div>
                        <div class="stat-label">–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                    </div>
                    <div class="stat-card crypto">
                        <div class="stat-value" id="crypto-news">0</div>
                        <div class="stat-label">–ö—Ä–∏–ø—Ç–æ</div>
                    </div>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-value" id="total-articles">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –≤ –±–∞–∑–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="last-24h">0</div>
                    <div class="stat-label">–ó–∞ 24 —á–∞—Å–∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sources-count">0</div>
                    <div class="stat-label">–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-news">0</div>
                    <div class="stat-label">–ü–æ–∫–∞–∑–∞–Ω–æ</div>
                    <div class="collection-status" id="collection-status"></div>
                </div>
            </div>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="loading" class="loading">
                <div class="radar-spinner"></div>
                <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ —Å–æ –≤—Å–µ–≥–æ –º–∏—Ä–∞...</p>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π -->
            <div id="news-container" class="news-grid hidden">
                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>RADAR PRO by City_F_Pressa</p>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/draftEditor.js') }}"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        document.getElementById('advanced-stats-btn')?.addEventListener('click', function() {
            const panel = document.getElementById('advanced-stats-panel');
            if (panel) {
                panel.classList.toggle('hidden');
                if (!panel.classList.contains('hidden')) {
                    loadAdvancedStats();
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π
        document.getElementById('neural-status-btn')?.addEventListener('click', async function() {
            const panel = document.getElementById('neural-status-panel');
            const content = document.getElementById('neural-status-content');
            
            if (panel && content) {
                if (panel.style.display === 'none' || panel.classList.contains('hidden')) {
                    try {
                        const response = await fetch('/api/neural-status');
                        const status = await response.json();
                        
                        content.innerHTML = `
                            <div class="neural-status-item">
                                <span>–ú–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:</span>
                                <span class="status-${status.neural_models_loaded ? 'ok' : 'error'}">
                                    ${status.neural_models_loaded ? '‚úÖ' : '‚ùå'}
                                </span>
                            </div>
                            <div class="neural-status-item">
                                <span>–≠–º–±–µ–¥–¥–∏–Ω–≥–∏:</span>
                                <span class="status-${status.embedding_model ? 'ok' : 'error'}">
                                    ${status.embedding_model ? '‚úÖ' : '‚ùå'}
                                </span>
                            </div>
                            <div class="neural-status-item">
                                <span>NER –º–æ–¥–µ–ª—å:</span>
                                <span class="status-${status.ner_pipeline ? 'ok' : 'error'}">
                                    ${status.ner_pipeline ? '‚úÖ' : '‚ùå'}
                                </span>
                            </div>
                            <div class="neural-status-item">
                                <span>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</span>
                                <span>${status.device || 'unknown'}</span>
                            </div>
                            <div class="neural-status-item">
                                <span>–û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏:</span>
                                <span>${status.queue_size || 0}</span>
                            </div>
                            ${status.error ? `
                            <div class="neural-status-item error">
                                <span>–û—à–∏–±–∫–∞:</span>
                                <span>${status.error}</span>
                            </div>
                            ` : ''}
                        `;
                        
                        panel.classList.remove('hidden');
                    } catch (error) {
                        content.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ AI';
                        panel.classList.remove('hidden');
                    }
                } else {
                    panel.classList.add('hidden');
                }
            }
        });

        async function loadAdvancedStats() {
            try {
                const response = await fetch('/api/advanced-stats');
                const data = await response.json();
                
                const internationalEl = document.getElementById('international-news');
                const russianEl = document.getElementById('russian-news');
                const highPriorityEl = document.getElementById('high-priority-count');
                const cryptoEl = document.getElementById('crypto-news');
                
                if (internationalEl) internationalEl.textContent = data.international || 0;
                if (russianEl) russianEl.textContent = data.russian || 0;
                if (highPriorityEl) highPriorityEl.textContent = data.high_priority || 0;
                if (cryptoEl) cryptoEl.textContent = data.crypto || 0;
                
            } catch (error) {
                console.error('Error loading advanced stats:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        function initializeSorting() {
            const sortSelect = document.getElementById('sort-select');
            const prioritySelect = document.getElementById('priority-select');
            
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    window.currentSort = this.value;
                    loadNews();
                });
            }
            
            if (prioritySelect) {
                prioritySelect.addEventListener('change', function() {
                    window.currentPriority = this.value;
                    loadNews();
                });
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        window.currentSort = 'hotness';
        window.currentPriority = 'all';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            initializeSorting();
        });
    </script>
</body>
</html>